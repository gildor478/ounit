<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>OUnit2 (ounit.OUnit2)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../index.html">ounit</a> &#x00BB; OUnit2</nav><h1>Module <code>OUnit2</code></h1><p>Unit test building blocks (v2).</p><dl><dt>author</dt><dd>Sylvain Le Gall</dd></dl><nav class="toc"><ul><li><a href="#types">Types</a></li><li><a href="#assertions">Assertions</a></li><li><a href="#skipping-tests">Skipping tests</a></li><li><a href="#compare-functions">Compare Functions</a></li><li><a href="#bracket">Bracket</a></li><li><a href="#constructing-tests">Constructing Tests</a></li><li><a href="#performing-tests">Performing Tests</a></li></ul></nav></header><section><header><h3 id="types"><a href="#types" class="anchor"></a>Types</h3></header><dl><dt class="spec type" id="type-test_ctxt"><a href="#type-test_ctxt" class="anchor"></a><code><span class="keyword">type</span> test_ctxt</code><code> = <a href="../OUnitTest/index.html#type-ctxt">OUnitTest.ctxt</a></code></dt><dd><p>Context of a test.</p></dd></dl><dl><dt class="spec type" id="type-test_fun"><a href="#type-test_fun" class="anchor"></a><code><span class="keyword">type</span> test_fun</code><code> = <a href="index.html#type-test_ctxt">test_ctxt</a> <span>&#45;&gt;</span> unit</code></dt><dd><p>The type of test function.</p></dd></dl><dl><dt class="spec type" id="type-test"><a href="#type-test" class="anchor"></a><code><span class="keyword">type</span> test</code><code> = <a href="../OUnitTest/index.html#type-test">OUnitTest.test</a></code></dt><dd><p>The type of test.</p></dd></dl><dl><dt class="spec type" id="type-test_length"><a href="#type-test_length" class="anchor"></a><code><span class="keyword">type</span> test_length</code><code> = <a href="../OUnitTest/index.html#type-test_length">OUnitTest.test_length</a></code></dt><dd><p>The expected length of the test.</p></dd></dl></section><section><header><h3 id="assertions"><a href="#assertions" class="anchor"></a>Assertions</h3><p>Assertions are the basic building blocks of unittests.</p></header><dl><dt class="spec value" id="val-assert_failure"><a href="#val-assert_failure" class="anchor"></a><code><span class="keyword">val</span> assert_failure : string <span>&#45;&gt;</span> <span class="type-var">'a</span></code></dt><dd><p>Signals a failure. This will raise an exception with the specified string.</p><dl><dt>raises Failure</dt><dd><p>signal a failure</p></dd></dl></dd></dl><dl><dt class="spec value" id="val-assert_bool"><a href="#val-assert_bool" class="anchor"></a><code><span class="keyword">val</span> assert_bool : string <span>&#45;&gt;</span> bool <span>&#45;&gt;</span> unit</code></dt><dd><p>Signals a failure when bool is false. The string identifies the failure.</p><dl><dt>raises Failure</dt><dd><p>signal a failure</p></dd></dl></dd></dl><dl><dt class="spec value" id="val-assert_string"><a href="#val-assert_string" class="anchor"></a><code><span class="keyword">val</span> assert_string : string <span>&#45;&gt;</span> unit</code></dt><dd><p>Signals a failure when the string is non-empty. The string identifies the failure.</p><dl><dt>raises Failure</dt><dd><p>signal a failure</p></dd></dl></dd></dl><dl><dt class="spec value" id="val-assert_command"><a href="#val-assert_command" class="anchor"></a><code><span class="keyword">val</span> assert_command : ?&#8288;exit_code:Unix.process_status <span>&#45;&gt;</span> ?&#8288;sinput:char Stdlib.Stream.t <span>&#45;&gt;</span> ?&#8288;foutput:(char Stdlib.Stream.t <span>&#45;&gt;</span> unit) <span>&#45;&gt;</span> ?&#8288;use_stderr:bool <span>&#45;&gt;</span> ?&#8288;backtrace:bool <span>&#45;&gt;</span> ?&#8288;chdir:string <span>&#45;&gt;</span> ?&#8288;env:string array <span>&#45;&gt;</span> ctxt:<a href="index.html#type-test_ctxt">test_ctxt</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> string list <span>&#45;&gt;</span> unit</code></dt><dd><p><code>assert_command prg args</code> Run the command provided.</p><dl><dt>parameter exit_code</dt><dd><p>expected exit code</p></dd></dl><dl><dt>parameter sinput</dt><dd><p>provide this <code>char Stream.t</code> as input of the process</p></dd></dl><dl><dt>parameter foutput</dt><dd><p>run this function on output, it can contains an <code>assert_equal</code> to check it</p></dd></dl><dl><dt>parameter use_stderr</dt><dd><p>redirect <code>stderr</code> to <code>stdout</code></p></dd></dl><dl><dt>parameter backtrace</dt><dd><p>Set OCAMLRUNPARAM=b</p></dd></dl><dl><dt>parameter chdir</dt><dd><p>Chdir into a directory before running the command.</p></dd></dl><dl><dt>parameter env</dt><dd><p>Unix environment</p></dd></dl><dl><dt>parameter verbose</dt><dd><p>if a failed, dump stdout/stderr of the process to stderr</p></dd></dl></dd></dl><dl><dt class="spec value" id="val-assert_equal"><a href="#val-assert_equal" class="anchor"></a><code><span class="keyword">val</span> assert_equal : ?&#8288;ctxt:<a href="index.html#type-test_ctxt">test_ctxt</a> <span>&#45;&gt;</span> ?&#8288;cmp:(<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> bool) <span>&#45;&gt;</span> ?&#8288;printer:(<span class="type-var">'a</span> <span>&#45;&gt;</span> string) <span>&#45;&gt;</span> ?&#8288;pp_diff:(Stdlib.Format.formatter <span>&#45;&gt;</span> (<span class="type-var">'a</span> * <span class="type-var">'a</span>) <span>&#45;&gt;</span> unit) <span>&#45;&gt;</span> ?&#8288;msg:string <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>assert_equal expected real</code> Compares two values, when they are not equal a failure is signaled.</p><dl><dt>parameter cmp</dt><dd><p>customize function to compare, default is <code>=</code></p></dd></dl><dl><dt>parameter printer</dt><dd><p>value printer, don't print value otherwise</p></dd></dl><dl><dt>parameter pp_diff</dt><dd><p>if not equal, ask a custom display of the difference using <code>diff fmt exp real</code> where <code>fmt</code> is the formatter to use</p></dd></dl><dl><dt>parameter msg</dt><dd><p>custom message to identify the failure</p></dd></dl><dl><dt>parameter ctxt</dt><dd><p>if provided, always print expected and real value</p></dd></dl><dl><dt>raises Failure</dt><dd><p>signal a failure</p></dd></dl></dd></dl><dl><dt class="spec value" id="val-assert_raises"><a href="#val-assert_raises" class="anchor"></a><code><span class="keyword">val</span> assert_raises : ?&#8288;msg:string <span>&#45;&gt;</span> exn <span>&#45;&gt;</span> (unit <span>&#45;&gt;</span> unit) <span>&#45;&gt;</span> unit</code></dt><dd><p>Asserts if the expected exception was raised.</p><dl><dt>parameter msg</dt><dd><p>identify the failure</p></dd></dl><dl><dt>raises Failure</dt><dd><p>description</p></dd></dl></dd></dl></section><section><header><h3 id="skipping-tests"><a href="#skipping-tests" class="anchor"></a>Skipping tests</h3><p>In certain condition test can be written but there is no point running it, because they are not significant (missing OS features for example). In this case this is not a failure nor a success. Following functions allow you to escape test, just as assertion but without the same error status.</p><p>A test skipped is counted as success. A test todo is counted as failure.</p></header><dl><dt class="spec value" id="val-skip_if"><a href="#val-skip_if" class="anchor"></a><code><span class="keyword">val</span> skip_if : bool <span>&#45;&gt;</span> string <span>&#45;&gt;</span> unit</code></dt><dd><p><code>skip cond msg</code> If <code>cond</code> is true, skip the test for the reason explain in <code>msg</code>. For example <code>skip_if (Sys.os_type = &quot;Win32&quot;) &quot;Test a doesn't run on
    windows&quot;</code>.</p></dd></dl><dl><dt class="spec value" id="val-todo"><a href="#val-todo" class="anchor"></a><code><span class="keyword">val</span> todo : string <span>&#45;&gt;</span> unit</code></dt><dd><p>The associated test is still to be done, for the reason given.</p></dd></dl></section><section><header><h3 id="compare-functions"><a href="#compare-functions" class="anchor"></a>Compare Functions</h3></header><dl><dt class="spec value" id="val-cmp_float"><a href="#val-cmp_float" class="anchor"></a><code><span class="keyword">val</span> cmp_float : ?&#8288;epsilon:float <span>&#45;&gt;</span> float <span>&#45;&gt;</span> float <span>&#45;&gt;</span> bool</code></dt><dd><p>Compare floats up to a given relative error.</p><p>In keeping with standard floating point semantics, NaN is not equal to anything: <code>cmp_float nan nan = false</code>.</p><dl><dt>parameter epsilon</dt><dd><p>if the difference is smaller <code>epsilon</code> values are equal</p></dd></dl></dd></dl></section><section><header><h3 id="bracket"><a href="#bracket" class="anchor"></a>Bracket</h3><p>A bracket is a registered object with setUp and tearDown in unit tests. Data generated during the setUp will be automatically tearDown when the test ends.</p></header><dl><dt class="spec value" id="val-bracket"><a href="#val-bracket" class="anchor"></a><code><span class="keyword">val</span> bracket : (<a href="index.html#type-test_ctxt">test_ctxt</a> <span>&#45;&gt;</span> <span class="type-var">'a</span>) <span>&#45;&gt;</span> (<span class="type-var">'a</span> <span>&#45;&gt;</span> <a href="index.html#type-test_ctxt">test_ctxt</a> <span>&#45;&gt;</span> unit) <span>&#45;&gt;</span> <a href="index.html#type-test_ctxt">test_ctxt</a> <span>&#45;&gt;</span> <span class="type-var">'a</span></code></dt><dd><p><code>bracket set_up tear_down test_ctxt</code> set up an object and register it to be tore down in <code>test_ctxt</code>.</p></dd></dl><dl><dt class="spec value" id="val-bracket_tmpfile"><a href="#val-bracket_tmpfile" class="anchor"></a><code><span class="keyword">val</span> bracket_tmpfile : ?&#8288;prefix:string <span>&#45;&gt;</span> ?&#8288;suffix:string <span>&#45;&gt;</span> ?&#8288;mode:Stdlib.open_flag list <span>&#45;&gt;</span> <a href="index.html#type-test_ctxt">test_ctxt</a> <span>&#45;&gt;</span> string * Stdlib.out_channel</code></dt><dd><p><code>bracket_tmpfile test_ctxt</code> Create a temporary filename and matching output channel. The temporary file is removed after the test.</p><dl><dt>parameter prefix</dt><dd><p>see <code>Filename.open_temp_file</code></p></dd></dl><dl><dt>parameter suffix</dt><dd><p>see <code>Filename.open_temp_file</code></p></dd></dl><dl><dt>parameter mode</dt><dd><p>see <code>Filename.open_temp_file</code></p></dd></dl></dd></dl><dl><dt class="spec value" id="val-bracket_tmpdir"><a href="#val-bracket_tmpdir" class="anchor"></a><code><span class="keyword">val</span> bracket_tmpdir : ?&#8288;prefix:string <span>&#45;&gt;</span> ?&#8288;suffix:string <span>&#45;&gt;</span> <a href="index.html#type-test_ctxt">test_ctxt</a> <span>&#45;&gt;</span> string</code></dt><dd><p><code>bracket_tmpdir test_ctxt</code> Create a temporary dirname. The temporary directory is removed after the test.</p><dl><dt>parameter prefix</dt><dd><p>see <code>Filename.open_temp_file</code></p></dd></dl><dl><dt>parameter suffix</dt><dd><p>see <code>Filename.open_temp_file</code></p></dd></dl></dd></dl><dl><dt class="spec value" id="val-with_bracket_chdir"><a href="#val-with_bracket_chdir" class="anchor"></a><code><span class="keyword">val</span> with_bracket_chdir : <a href="index.html#type-test_ctxt">test_ctxt</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> (<a href="index.html#type-test_ctxt">test_ctxt</a> <span>&#45;&gt;</span> <span class="type-var">'a</span>) <span>&#45;&gt;</span> <span class="type-var">'a</span></code></dt><dd><p><code>with_bracket_chdir test_ctxt dn f</code> change directory to <code>dn</code> during execution of function <code>f</code>. In order to <code>Sys.chdir</code>, we need to take a lock to avoid other tests trying to do change the current directory at the same time. So this bracket is not directly accessible in order to use it only on shorter piece of code.</p></dd></dl></section><section><header><h3 id="constructing-tests"><a href="#constructing-tests" class="anchor"></a>Constructing Tests</h3></header><dl><dt class="spec value" id="val-(&gt;:)"><a href="#val-(&gt;:)" class="anchor"></a><code><span class="keyword">val</span> (&gt;:) : string <span>&#45;&gt;</span> <a href="index.html#type-test">test</a> <span>&#45;&gt;</span> <a href="index.html#type-test">test</a></code></dt><dd><p>Create a TestLabel for a test</p></dd></dl><dl><dt class="spec value" id="val-(&gt;::)"><a href="#val-(&gt;::)" class="anchor"></a><code><span class="keyword">val</span> (&gt;::) : string <span>&#45;&gt;</span> <a href="index.html#type-test_fun">test_fun</a> <span>&#45;&gt;</span> <a href="index.html#type-test">test</a></code></dt><dd><p>Create a TestLabel for a TestCase</p></dd></dl><dl><dt class="spec value" id="val-(&gt;:::)"><a href="#val-(&gt;:::)" class="anchor"></a><code><span class="keyword">val</span> (&gt;:::) : string <span>&#45;&gt;</span> <a href="index.html#type-test">test</a> list <span>&#45;&gt;</span> <a href="index.html#type-test">test</a></code></dt><dd><p>Create a TestLabel for a TestList</p></dd></dl><dl><dt class="spec value" id="val-test_case"><a href="#val-test_case" class="anchor"></a><code><span class="keyword">val</span> test_case : ?&#8288;length:<a href="index.html#type-test_length">test_length</a> <span>&#45;&gt;</span> <a href="index.html#type-test_fun">test_fun</a> <span>&#45;&gt;</span> <a href="index.html#type-test">test</a></code></dt><dd><p>Generic function to create a test case.</p></dd></dl><dl><dt class="spec value" id="val-test_list"><a href="#val-test_list" class="anchor"></a><code><span class="keyword">val</span> test_list : <a href="index.html#type-test">test</a> list <span>&#45;&gt;</span> <a href="index.html#type-test">test</a></code></dt><dd><p>Generic function to create a test list.</p></dd></dl><aside><p>Some shorthands which allows easy test construction.</p><p>Examples:</p><ul><li><code>&quot;test1&quot; &gt;: TestCase((fun _ -&gt; ()))</code> =&gt; <code>TestLabel(&quot;test2&quot;, TestCase((fun _ -&gt; ())))</code></li><li><code>&quot;test2&quot; &gt;:: (fun _ -&gt; ())</code> =&gt; <code>TestLabel(&quot;test2&quot;, TestCase((fun _ -&gt; ())))</code></li><li><code>&quot;test-suite&quot; &gt;::: [&quot;test2&quot; &gt;:: (fun _ -&gt; ());]</code> =&gt; <code>TestLabel(&quot;test-suite&quot;, TestSuite([TestLabel(&quot;test2&quot;,
                                       TestCase((fun _ -&gt; ())))]))</code></li></ul></aside></section><section><header><h3 id="performing-tests"><a href="#performing-tests" class="anchor"></a>Performing Tests</h3></header><dl><dt class="spec type" id="type-log_severity"><a href="#type-log_severity" class="anchor"></a><code><span class="keyword">type</span> log_severity</code> = <code>[ </code><table class="variant"><tr id="type-log_severity.Error" class="anchored"><td class="def constructor"><a href="#type-log_severity.Error" class="anchor"></a><code>| </code><code>`Error</code></td></tr><tr id="type-log_severity.Warning" class="anchored"><td class="def constructor"><a href="#type-log_severity.Warning" class="anchor"></a><code>| </code><code>`Warning</code></td></tr><tr id="type-log_severity.Info" class="anchored"><td class="def constructor"><a href="#type-log_severity.Info" class="anchor"></a><code>| </code><code>`Info</code></td></tr></table><code> ]</code></dt><dd><p>Severity level for log.</p></dd></dl><dl><dt class="spec value" id="val-logf"><a href="#val-logf" class="anchor"></a><code><span class="keyword">val</span> logf : <a href="index.html#type-test_ctxt">test_ctxt</a> <span>&#45;&gt;</span> <a href="index.html#type-log_severity">log_severity</a> <span>&#45;&gt;</span> (<span class="type-var">'a</span>, unit, string, unit) Stdlib.format4 <span>&#45;&gt;</span> <span class="type-var">'a</span></code></dt><dd><p>Log into OUnit logging system.</p></dd></dl><dl><dt class="spec value" id="val-in_testdata_dir"><a href="#val-in_testdata_dir" class="anchor"></a><code><span class="keyword">val</span> in_testdata_dir : <a href="index.html#type-test_ctxt">test_ctxt</a> <span>&#45;&gt;</span> string list <span>&#45;&gt;</span> string</code></dt><dd><p>Build a filename for a file that should be located in the test data dir.</p><p>The test data dir, can be defined on the command line (preferably absolute) The default option is to locate it in topsrcdir/test/data.</p></dd></dl><dl><dt class="spec value" id="val-non_fatal"><a href="#val-non_fatal" class="anchor"></a><code><span class="keyword">val</span> non_fatal : <a href="index.html#type-test_ctxt">test_ctxt</a> <span>&#45;&gt;</span> (<a href="index.html#type-test_ctxt">test_ctxt</a> <span>&#45;&gt;</span> unit) <span>&#45;&gt;</span> unit</code></dt><dd><p><code>non_fatal ctxt f</code> Run <code>f</code> but if an exception is raised or an assert fails, don't stop, just register the result. The global test running result will mix in the non fatal result to determine the success or failure of the test.</p></dd></dl><dl><dt class="spec module" id="module-Conf"><a href="#module-Conf" class="anchor"></a><code><span class="keyword">module</span> <a href="Conf/index.html">Conf</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Define command line options, environment variables and file configuration.</p></dd></dl><dl><dt class="spec value" id="val-run_test_tt_main"><a href="#val-run_test_tt_main" class="anchor"></a><code><span class="keyword">val</span> run_test_tt_main : ?&#8288;exit:(int <span>&#45;&gt;</span> unit) <span>&#45;&gt;</span> <a href="index.html#type-test">test</a> <span>&#45;&gt;</span> unit</code></dt><dd><p>Main version of the text based test runner. It reads the supplied command line arguments to set the verbose level and limit the number of test to run.</p><dl><dt>parameter test</dt><dd><p>the test suite to run.</p></dd></dl></dd></dl></section></div></body></html>