<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>OUnit2 (ounit2.OUnit2)</title><link rel="stylesheet" href="../../_odoc_support/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.2.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../_odoc_support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../index.html">ounit2</a> &#x00BB; OUnit2</nav><header class="odoc-preamble"><h1>Module <code><span>OUnit2</span></code></h1><p>Unit test building blocks (v2).</p><ul class="at-tags"><li class="author"><span class="at-tag">author</span> Sylvain Le Gall</li></ul></header><nav class="odoc-toc"><ul><li><a href="#types">Types</a></li><li><a href="#assertions">Assertions</a></li><li><a href="#skipping-tests">Skipping tests</a></li><li><a href="#compare-functions">Compare Functions</a></li><li><a href="#bracket">Bracket</a></li><li><a href="#constructing-tests">Constructing Tests</a></li><li><a href="#performing-tests">Performing Tests</a></li></ul></nav><div class="odoc-content"><h3 id="types"><a href="#types" class="anchor"></a>Types</h3><div class="odoc-spec"><div class="spec type anchored" id="type-test_ctxt"><a href="#type-test_ctxt" class="anchor"></a><code><span><span class="keyword">type</span> test_ctxt</span><span> = <a href="../OUnitTest/index.html#type-ctxt">OUnitTest.ctxt</a></span></code></div><div class="spec-doc"><p>Context of a test.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-test_fun"><a href="#type-test_fun" class="anchor"></a><code><span><span class="keyword">type</span> test_fun</span><span> = <span><a href="#type-test_ctxt">test_ctxt</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>The type of test function.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-test"><a href="#type-test" class="anchor"></a><code><span><span class="keyword">type</span> test</span><span> = <a href="../OUnitTest/index.html#type-test">OUnitTest.test</a></span></code></div><div class="spec-doc"><p>The type of test.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-test_length"><a href="#type-test_length" class="anchor"></a><code><span><span class="keyword">type</span> test_length</span><span> = <a href="../OUnitTest/index.html#type-test_length">OUnitTest.test_length</a></span></code></div><div class="spec-doc"><p>The expected length of the test.</p></div></div><h3 id="assertions"><a href="#assertions" class="anchor"></a>Assertions</h3><p>Assertions are the basic building blocks of unittests.</p><div class="odoc-spec"><div class="spec value anchored" id="val-assert_failure"><a href="#val-assert_failure" class="anchor"></a><code><span><span class="keyword">val</span> assert_failure : <span>string <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p>Signals a failure. This will raise an exception with the specified string.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <span class="value">Failure</span> <p>signal a failure</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-assert_bool"><a href="#val-assert_bool" class="anchor"></a><code><span><span class="keyword">val</span> assert_bool : <span>string <span class="arrow">&#45;&gt;</span></span> <span>bool <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Signals a failure when bool is false. The string identifies the failure.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <span class="value">Failure</span> <p>signal a failure</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-assert_string"><a href="#val-assert_string" class="anchor"></a><code><span><span class="keyword">val</span> assert_string : <span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Signals a failure when the string is non-empty. The string identifies the failure.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <span class="value">Failure</span> <p>signal a failure</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-assert_command"><a href="#val-assert_command" class="anchor"></a><code><span><span class="keyword">val</span> assert_command : 
  <span>?exit_code:<span class="xref-unresolved">Unix</span>.process_status <span class="arrow">&#45;&gt;</span></span>
  <span>?sinput:<span>char <span class="xref-unresolved">Stdlib</span>.Seq.t</span> <span class="arrow">&#45;&gt;</span></span>
  <span>?foutput:<span>(<span><span>char <span class="xref-unresolved">Stdlib</span>.Seq.t</span> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
  <span>?use_stderr:bool <span class="arrow">&#45;&gt;</span></span>
  <span>?backtrace:bool <span class="arrow">&#45;&gt;</span></span>
  <span>?chdir:string <span class="arrow">&#45;&gt;</span></span>
  <span>?env:<span>string array</span> <span class="arrow">&#45;&gt;</span></span>
  <span>ctxt:<a href="#type-test_ctxt">test_ctxt</a> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p><code>assert_command prg args</code> Run the command provided.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">exit_code</span> <p>expected exit code</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">sinput</span> <p>provide this <code>char Seq.t</code> as input of the process</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">foutput</span> <p>run this function on output, it can contains an <code>assert_equal</code> to check it</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">use_stderr</span> <p>redirect <code>stderr</code> to <code>stdout</code></p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">backtrace</span> <p>Set OCAMLRUNPARAM=b</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">chdir</span> <p>Chdir into a directory before running the command.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">env</span> <p>Unix environment</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">verbose</span> <p>if a failed, dump stdout/stderr of the process to stderr</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-assert_equal"><a href="#val-assert_equal" class="anchor"></a><code><span><span class="keyword">val</span> assert_equal : 
  <span>?ctxt:<a href="#type-test_ctxt">test_ctxt</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?cmp:<span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> bool)</span> <span class="arrow">&#45;&gt;</span></span>
  <span>?printer:<span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> string)</span> <span class="arrow">&#45;&gt;</span></span>
  <span>?pp_diff:<span>(<span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span> * <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
  <span>?msg:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p><code>assert_equal expected real</code> Compares two values, when they are not equal a failure is signaled.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">cmp</span> <p>customize function to compare, default is <code>=</code></p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">printer</span> <p>value printer, don't print value otherwise</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">pp_diff</span> <p>if not equal, ask a custom display of the difference using <code>diff fmt exp real</code> where <code>fmt</code> is the formatter to use</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">msg</span> <p>custom message to identify the failure</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">ctxt</span> <p>if provided, always print expected and real value</p></li></ul><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <span class="value">Failure</span> <p>signal a failure</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-assert_raises"><a href="#val-assert_raises" class="anchor"></a><code><span><span class="keyword">val</span> assert_raises : <span>?msg:string <span class="arrow">&#45;&gt;</span></span> <span>exn <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Asserts if the expected exception was raised.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">msg</span> <p>identify the failure</p></li></ul><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <span class="value">Failure</span> <p>description</p></li></ul></div></div><h3 id="skipping-tests"><a href="#skipping-tests" class="anchor"></a>Skipping tests</h3><p>In certain condition test can be written but there is no point running it, because they are not significant (missing OS features for example). In this case this is not a failure nor a success. Following functions allow you to escape test, just as assertion but without the same error status.</p><p>A test skipped is counted as success. A test todo is counted as failure.</p><div class="odoc-spec"><div class="spec value anchored" id="val-skip_if"><a href="#val-skip_if" class="anchor"></a><code><span><span class="keyword">val</span> skip_if : <span>bool <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>skip cond msg</code> If <code>cond</code> is true, skip the test for the reason explain in <code>msg</code>. For example <code>skip_if (Sys.os_type = &quot;Win32&quot;) &quot;Test a doesn't run on
    windows&quot;</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-todo"><a href="#val-todo" class="anchor"></a><code><span><span class="keyword">val</span> todo : <span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>The associated test is still to be done, for the reason given.</p></div></div><h3 id="compare-functions"><a href="#compare-functions" class="anchor"></a>Compare Functions</h3><div class="odoc-spec"><div class="spec value anchored" id="val-cmp_float"><a href="#val-cmp_float" class="anchor"></a><code><span><span class="keyword">val</span> cmp_float : <span>?epsilon:float <span class="arrow">&#45;&gt;</span></span> <span>float <span class="arrow">&#45;&gt;</span></span> <span>float <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Compare floats up to a given relative error.</p><p>In keeping with standard floating point semantics, NaN is not equal to anything: <code>cmp_float nan nan = false</code>.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">epsilon</span> <p>if the difference is smaller <code>epsilon</code> values are equal</p></li></ul></div></div><h3 id="bracket"><a href="#bracket" class="anchor"></a>Bracket</h3><p>A bracket is a registered object with setUp and tearDown in unit tests. Data generated during the setUp will be automatically tearDown when the test ends.</p><div class="odoc-spec"><div class="spec value anchored" id="val-bracket"><a href="#val-bracket" class="anchor"></a><code><span><span class="keyword">val</span> bracket : <span><span>(<span><a href="#type-test_ctxt">test_ctxt</a> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-test_ctxt">test_ctxt</a> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-test_ctxt">test_ctxt</a> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>bracket set_up tear_down test_ctxt</code> set up an object and register it to be tore down in <code>test_ctxt</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bracket_tmpfile"><a href="#val-bracket_tmpfile" class="anchor"></a><code><span><span class="keyword">val</span> bracket_tmpfile : 
  <span>?prefix:string <span class="arrow">&#45;&gt;</span></span>
  <span>?suffix:string <span class="arrow">&#45;&gt;</span></span>
  <span>?mode:<span><span class="xref-unresolved">Stdlib</span>.open_flag list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-test_ctxt">test_ctxt</a> <span class="arrow">&#45;&gt;</span></span>
  string * <span class="xref-unresolved">Stdlib</span>.out_channel</span></code></div><div class="spec-doc"><p><code>bracket_tmpfile test_ctxt</code> Create a temporary filename and matching output channel. The temporary file is removed after the test.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">prefix</span> <p>see <code>Filename.open_temp_file</code></p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">suffix</span> <p>see <code>Filename.open_temp_file</code></p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">mode</span> <p>see <code>Filename.open_temp_file</code></p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bracket_tmpdir"><a href="#val-bracket_tmpdir" class="anchor"></a><code><span><span class="keyword">val</span> bracket_tmpdir : <span>?prefix:string <span class="arrow">&#45;&gt;</span></span> <span>?suffix:string <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-test_ctxt">test_ctxt</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p><code>bracket_tmpdir test_ctxt</code> Create a temporary dirname. The temporary directory is removed after the test.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">prefix</span> <p>see <code>Filename.open_temp_file</code></p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">suffix</span> <p>see <code>Filename.open_temp_file</code></p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-with_bracket_chdir"><a href="#val-with_bracket_chdir" class="anchor"></a><code><span><span class="keyword">val</span> with_bracket_chdir : <span><a href="#type-test_ctxt">test_ctxt</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><a href="#type-test_ctxt">test_ctxt</a> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>with_bracket_chdir test_ctxt dn f</code> change directory to <code>dn</code> during execution of function <code>f</code>. In order to <code>Sys.chdir</code>, we need to take a lock to avoid other tests trying to do change the current directory at the same time. So this bracket is not directly accessible in order to use it only on shorter piece of code.</p></div></div><h3 id="constructing-tests"><a href="#constructing-tests" class="anchor"></a>Constructing Tests</h3><div class="odoc-spec"><div class="spec value anchored" id="val-(&gt;:)"><a href="#val-(&gt;:)" class="anchor"></a><code><span><span class="keyword">val</span> (&gt;:) : <span>string <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-test">test</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-test">test</a></span></code></div><div class="spec-doc"><p>Create a TestLabel for a test</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-(&gt;::)"><a href="#val-(&gt;::)" class="anchor"></a><code><span><span class="keyword">val</span> (&gt;::) : <span>string <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-test_fun">test_fun</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-test">test</a></span></code></div><div class="spec-doc"><p>Create a TestLabel for a TestCase</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-(&gt;:::)"><a href="#val-(&gt;:::)" class="anchor"></a><code><span><span class="keyword">val</span> (&gt;:::) : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-test">test</a> list</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-test">test</a></span></code></div><div class="spec-doc"><p>Create a TestLabel for a TestList</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-test_case"><a href="#val-test_case" class="anchor"></a><code><span><span class="keyword">val</span> test_case : <span>?length:<a href="#type-test_length">test_length</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-test_fun">test_fun</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-test">test</a></span></code></div><div class="spec-doc"><p>Generic function to create a test case.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-test_list"><a href="#val-test_list" class="anchor"></a><code><span><span class="keyword">val</span> test_list : <span><span><a href="#type-test">test</a> list</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-test">test</a></span></code></div><div class="spec-doc"><p>Generic function to create a test list.</p></div></div><p>Some shorthands which allows easy test construction.</p><p>Examples:</p><ul><li><code>&quot;test1&quot; &gt;: TestCase((fun _ -&gt; ()))</code> =&gt; <code>TestLabel(&quot;test2&quot;, TestCase((fun _ -&gt; ())))</code></li><li><code>&quot;test2&quot; &gt;:: (fun _ -&gt; ())</code> =&gt; <code>TestLabel(&quot;test2&quot;, TestCase((fun _ -&gt; ())))</code></li><li><code>&quot;test-suite&quot; &gt;::: [&quot;test2&quot; &gt;:: (fun _ -&gt; ());]</code> =&gt; <code>TestLabel(&quot;test-suite&quot;, TestSuite([TestLabel(&quot;test2&quot;,
                                       TestCase((fun _ -&gt; ())))]))</code></li></ul><h3 id="performing-tests"><a href="#performing-tests" class="anchor"></a>Performing Tests</h3><div class="odoc-spec"><div class="spec type anchored" id="type-log_severity"><a href="#type-log_severity" class="anchor"></a><code><span><span class="keyword">type</span> log_severity</span><span> = </span><span>[ </span></code><ol><li id="type-log_severity.Error" class="def constructor anchored"><a href="#type-log_severity.Error" class="anchor"></a><code><span>| </span></code><code><span>`Error</span></code></li><li id="type-log_severity.Warning" class="def constructor anchored"><a href="#type-log_severity.Warning" class="anchor"></a><code><span>| </span></code><code><span>`Warning</span></code></li><li id="type-log_severity.Info" class="def constructor anchored"><a href="#type-log_severity.Info" class="anchor"></a><code><span>| </span></code><code><span>`Info</span></code></li></ol><code><span> ]</span></code></div><div class="spec-doc"><p>Severity level for log.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-logf"><a href="#val-logf" class="anchor"></a><code><span><span class="keyword">val</span> logf : 
  <span><a href="#type-test_ctxt">test_ctxt</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-log_severity">log_severity</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, unit, string, unit)</span> <span class="xref-unresolved">Stdlib</span>.format4</span> <span class="arrow">&#45;&gt;</span></span>
  <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p>Log into OUnit logging system.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-in_testdata_dir"><a href="#val-in_testdata_dir" class="anchor"></a><code><span><span class="keyword">val</span> in_testdata_dir : <span><a href="#type-test_ctxt">test_ctxt</a> <span class="arrow">&#45;&gt;</span></span> <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Build a filename for a file that should be located in the test data dir.</p><p>The test data dir, can be defined on the command line (preferably absolute) The default option is to locate it in topsrcdir/test/data.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-non_fatal"><a href="#val-non_fatal" class="anchor"></a><code><span><span class="keyword">val</span> non_fatal : <span><a href="#type-test_ctxt">test_ctxt</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><a href="#type-test_ctxt">test_ctxt</a> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>non_fatal ctxt f</code> Run <code>f</code> but if an exception is raised or an assert fails, don't stop, just register the result. The global test running result will mix in the non fatal result to determine the success or failure of the test.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Conf"><a href="#module-Conf" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Conf/index.html">Conf</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Define command line options, environment variables and file configuration.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-run_test_tt_main"><a href="#val-run_test_tt_main" class="anchor"></a><code><span><span class="keyword">val</span> run_test_tt_main : <span>?exit:<span>(<span>int <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-test">test</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Main version of the text based test runner. It reads the supplied command line arguments to set the verbose level and limit the number of test to run.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">test</span> <p>the test suite to run.</p></li></ul></div></div></div></body></html>